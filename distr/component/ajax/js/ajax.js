(()=>{"use strict";SF.Ajax=function(t,e=function(){},s=function(){}){this.updateparam=function(t){for(const e in t)this.param[e]=t[e]},this.isFunction=function(t){if("function"==typeof t)return!0;const e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e},this.isString=function(t){return"string"==typeof t},this.isEmptySource=function(t,e,s="js"){for(let n=0;n<t.length;n++)switch(s){case"js":if(-1!==t[n].src.indexOf(e))return!0;break;case"css":if(-1!==t[n].href.indexOf(e))return!0;break;case"js-line":if(-1!==t[n].innerHTML.indexOf(e))return!0}return!1},this.processHTML=function(t){const e={script:/<script([^>]*)>/gi,script_end:/<\/script>/gi,script_src:/src=["\']([^"\']+)["\']/i,script_type:/type=["\']([^"\']+)["\']/i,space:/\s+/,ltrim:/^[\s\r\n]+/g,rtrim:/[\s\r\n]+$/g,style:/<link.*?(rel="stylesheet"|type="text\/css")[^>]*>/i,style_href:/href=["\']([^"\']+)["\']/i};let s,n,r,i,a;const o=[],c=[],l=[];let d=e.script.lastIndex=e.script_end.lastIndex=0;const h=document.querySelectorAll("script[src]"),p=document.querySelectorAll("link[href]"),u=document.querySelectorAll("script:not([src])");for(;null!==(s=e.script.exec(t));){e.script_end.lastIndex=e.script.lastIndex;const n=e.script_end.exec(t);if(null===n)break;let i=!1;if(null!==(a=s[1].match(e.script_type))&&("text/html"!=a[1]&&"text/template"!=a[1]||(i=!0)),i)l.push([d,e.script_end.lastIndex-d]);else{l.push([d,s.index-d]);const i=this.param.scriptsRunFirst||"-1"!=s[1].indexOf("bxrunfirst");if(null!==(r=s[1].match(e.script_src)))this.isEmptySource(h,r[1].substr(0,r[1].lastIndexOf(".js")+3))||o.push({runFirst:i,isInternal:!1,JS:r[1]});else{const e=s.index+s[0].length,r=t.substr(e,n.index-e);this.isEmptySource(u,r,"js-line")||o.push({runFirst:i,isInternal:!0,JS:r})}}d=n.index+9,e.script.lastIndex=d}l.push([d,0===d?t.length:t.length-d]);let m="";for(let e=0,s=l.length;e<s;e++)this.isString(t)&&this.isFunction(t.substr)&&(m+=t.substr(l[e][0],l[e][1]));for(;null!==(n=m.match(e.style));)null!==(i=n[0].match(e.style_href))&&n[0].indexOf('media="')<0&&(this.isEmptySource(p,i[1].substr(0,i[1].lastIndexOf(".css")+4),"css")||c.push(i[1])),m=m.replace(n[0],"");return{HTML:m,SCRIPT:o,STYLE:c}},this.isInternalScript=function(t){let e=0;for(let s=0;s<t.length;s++)t[s].isInternal||e++;return e},this.loadJS=function(t){this.lengthJS=this.isInternalScript(t);for(let e=0;e<t.length;e++)if(!t[e].isInternal){const s=document.createElement("script");s.src=t[e].JS,s.setAttribute("modal-script",n.param.url),s.async=!0,s.addEventListener("load",(function(){n.lengthJS--,SF.send("SFAjaxLoadedScript",window),SF.send("SFAjaxLoadedResouce",window)})),document.head.append(s)}},this.loadJSDoc=t=>{for(let e=0;e<t.length;e++)if(t[e].isInternal){const s=document.createElement("script");s.setAttribute("modalInlineScript",n.param.url),s.innerHTML=t[e].JS,document.head.append(s)}},this.loadCSS=function(t){this.lengthCSS=t.length?t.length:0;for(let e=0;e<t.length;e++){const s=document.createElement("link");s.href=t[e],s.rel="stylesheet",s.type="text/css",s.addEventListener("load",(function(){n.lengthCSS--,SF.send("SFAjaxLoadedCSS",window),SF.send("SFAjaxLoadedResouce",window)})),document.head.append(s)}},this.emulateOnLoad=function(t){this.param.emulateOnload&&(SF.receive("SFAjaxLoadedResouce",window,(function(){n.lengthCSS<=0&&n.lengthJS<=0&&(n.loadJSDoc(t.SCRIPT),SF.send("DOMContentLoaded",window),SF.send("load",window))})),this.lengthCSS<=0&&this.lengthJS<=0&&(this.loadJSDoc(t.SCRIPT),SF.send("DOMContentLoaded",window),SF.send("load",window)))},this.body=function(){let t;if("json"===this.param.dataType)t=JSON.stringify(this.param.body);else{t=new FormData;for(const e in this.param.body)t.append(e,this.param.body[e])}return t},this.promise=function(){fetch(this.param.url,{method:this.param.method,mode:this.param.mode,cache:this.param.cache,headers:this.param.headers,redirect:this.param.redirect,referrerPolicy:this.param.referrerPolicy,body:this.body()}).then((function(t){if(!t.ok)throw new Error("HTTP error! status: "+t.status);return"json"===n.param.dataType?t.json():t.text()})).then((function(t){if("json"===n.param.dataType)e(t);else{const s=n.processHTML(t);n.loadCSS(s.STYLE),e(s.HTML),n.loadJS(s.SCRIPT),n.emulateOnLoad()}})).then((function(){s()}))},this.async=async function(){const t={method:this.param.method,mode:this.param.mode,cache:this.param.cache,headers:this.param.headers,redirect:this.param.redirect,referrerPolicy:this.param.referrerPolicy};"GET"!=this.param.method&&(t.body=this.body);const s=await fetch(this.param.url,t);let n;if("json"===this.param.dataType)n=await s.json(),e(n);else{n=await s.text();const t=this.processHTML(n);this.loadCSS(t.STYLE),e(t.HTML),this.loadJS(t.SCRIPT),this.emulateOnLoad(t)}},this.param={url:!1,method:"GET",mode:"no-cors",cache:"no-cache",redirect:"follow",referrerPolicy:"no-referrer",body:{},dataType:"html",async:!0,scriptsRunFirst:!0,emulateOnload:!0,headers:{}};var n=this;this.lengthJS=0,this.lengthCSS=0,this.updateparam(t),"json"===this.param.dataType&&(this.param.headers["Content-Type"]="application/json"),this.param.async?this.async():this.promise()}})();